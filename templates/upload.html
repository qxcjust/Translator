<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能文档翻译</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <div class="container">
        <h1 class="page-title">智能文档翻译</h1>
        <div class="upload-section" id="uploadSection">
            <div class="icon-section">
                <img src="{{ url_for('static', filename='images/icon-word.png') }}" alt="Word Icon">
                <img src="{{ url_for('static', filename='images/icon-excel.png') }}" alt="Excel Icon">
                <img src="{{ url_for('static', filename='images/icon-powerpoint.png') }}" alt="PowerPoint Icon">
                <img src="{{ url_for('static', filename='images/icon-pdf.png') }}" alt="PDF Icon">
            </div>
            <p class="supported-formats" style="color: rgb(55, 69, 103);">
                点击或拖动文件上传（可批量上传）
            </p>
            <button id="selectFileBtn">选择文档</button>
            <!-- 添加隐藏的文件输入元素 -->
            <input type="file" id="fileInput" style="display: none;" multiple>
            <div class="info-section">
                <p class="supported-formats" style="color: rgb(55, 69, 103);">
                    ·支持格式：DOCX、PPT、PPTX、XLS、XLSX
                </p>
                <p class="language-support" style="color: rgb(55, 69, 103);">
                    ·支持中、英、日 语种互译
                </p>
            </div>
            <!-- 添加错误信息显示区域 -->
            <div id="error-message" style="color: red; display: none;">
                <span>文件格式不支持！支持的格式为：.docx, .ppt, .pptx, .xls, .xlsx</span>
            </div>
            <!-- 添加进度条 -->
            <div id="progress-bar" style="width: 100%; height: 20px; background-color: #ddd; margin-top: 10px;">
                <div id="progress" style="height: 100%; width: 0%; background-color: green;"></div>
            </div>
            <!-- 添加语言选择下拉框 -->
            <div id="language-selector" style="margin-top: 10px;">
                <label for="source-lang">源语言:</label>
                <select id="source-lang">
                    <option value="zh">中文</option>
                    <option value="en">英文</option>
                    <option value="ja">日文</option>
                </select>
                <label for="target-lang">目标语言:</label>
                <select id="target-lang">
                    <option value="zh">中文</option>
                    <option value="en">英文</option>
                    <option value="ja">日文</option>
                </select>
            </div>
        </div>
    </div>
    <script>
        // 添加JavaScript代码以关联按钮和文件输入
        document.getElementById('selectFileBtn').addEventListener('click', function() {
            document.getElementById('fileInput').click();
        });

        // 添加文件选择后的处理逻辑
        document.getElementById('fileInput').addEventListener('change', function(event) {
            const files = event.target.files;
            handleFiles(files);
        });

        // 添加拖放事件处理逻辑
        const uploadSection = document.getElementById('uploadSection');
        uploadSection.addEventListener('dragover', function(event) {
            event.preventDefault();
            uploadSection.style.borderColor = 'blue'; // 可选：改变边框颜色以提示用户
        });

        uploadSection.addEventListener('dragleave', function(event) {
            event.preventDefault();
            uploadSection.style.borderColor = '#ddd'; // 恢复边框颜色
        });

        uploadSection.addEventListener('drop', function(event) {
            event.preventDefault();
            uploadSection.style.borderColor = '#ddd'; // 恢复边框颜色
            const files = event.dataTransfer.files;
            handleFiles(files);
        });

        function handleFiles(files) {
            if (files.length > 0) {
                const formData = new FormData();
                for (let i = 0; i < files.length; i++) {
                    formData.append('file', files[i]);
                }
                fetch('/upload', {
                    method: 'POST',
                    body: formData,
                    onprogress: function(event) {
                        if (event.lengthComputable) {
                            const percentComplete = Math.round((event.loaded / event.total) * 100);
                            document.getElementById('progress').style.width = percentComplete + '%';
                        }
                    }
                })
                .then(response => {
                    if (!response.ok) {
                        return response.json().then(data => {
                            throw new Error(data.error);
                        });
                    }
                    return response.json();
                })
                .then(data => {
                    alert(data.message);
                })
                .catch(error => {
                    console.error('Error:', error);
                    showErrorMessage();
                });
            }
        }

        function showErrorMessage() {
            document.getElementById('error-message').style.display = 'block';
            setTimeout(function() {
                document.getElementById('error-message').style.display = 'none';
            }, 10000);
        }
    </script>
    <script src="{{ url_for('static', filename='scripts.js') }}"></script>
</body>
</html>